@page "/"
@layout EmptyLayout
@inject NavigationManager Navigation
@inject Hospitality.Services.UserService UserService

<link rel="stylesheet" href="css/login.css" />

<div class="login-page">
	<div class="login-container">
		<div class="login-left">
			<div class="logo-container">
				<img src="images/InnSight.png" alt="InnSight Logo" class="innsight-logo" />
			</div>
			<h1 class="welcome-text">Welcome Back!</h1>
		</div>
		<div class="login-right">
			<div class="login-form">
				<h2 class="login-title">Log in</h2>
				@if (!string.IsNullOrEmpty(errorMessage))
				{
					<div class="error-banner"><span>⚠️</span> @errorMessage</div>
				}
				<div class="form-group">
					<div class="input-wrapper"><span class="input-icon">✉️</span><input type="email" class="form-input" placeholder="Email" @bind="email" /></div>
				</div>
				<div class="form-group">
					<div class="input-wrapper"><span class="input-icon">🔒</span><input type="@(showPassword ? "text" : "password")" class="form-input" placeholder="Password" @bind="password" /><button type="button" class="toggle-password" @onclick="TogglePasswordVisibility">@(showPassword ? "👁️" : "👁️‍🗨️")</button></div>
				</div>
				<button class="btn-login" @onclick="HandleLogin" disabled="@isLoading">@(isLoading?"Authenticating...":"Log in")</button>
				<div class="divider"><span>Or</span></div>
				<button class="btn-signup" @onclick="HandleSignup">Sign up</button>
			</div>
		</div>
	</div>
</div>

@code {
	string email=""; string password=""; bool showPassword=false; bool isLoading=false; string errorMessage="";
	void TogglePasswordVisibility()=> showPassword=!showPassword;
	async Task HandleLogin()
	{
		errorMessage="";
		if(string.IsNullOrWhiteSpace(email)|| string.IsNullOrWhiteSpace(password)) { errorMessage="Email and password required."; return; }
		isLoading=true;
		var user = await UserService.LoginAsync(email,password);
		isLoading=false;
		if(user==null) { errorMessage="Invalid credentials."; return; }
		var role = user.RoleName;
		if(role==Hospitality.Models.UserRoles.Admin) Navigation.NavigateTo("/admin");
		else if(role==Hospitality.Models.UserRoles.Staff) Navigation.NavigateTo("/staff");
		else if(role==Hospitality.Models.UserRoles.Client) Navigation.NavigateTo($"/client/profile/{user.UserId}");
		else errorMessage="Unknown role.";
	}
	void HandleSignup()=> Navigation.NavigateTo("/signup");
}
