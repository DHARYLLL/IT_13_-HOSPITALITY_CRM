# Messages System - Architecture Diagram

```
???????????????????????????????????????????????????????????????????????????
?   CLIENT MESSAGES SYSTEM     ?
?         InnSight Hospitality CRM       ?
???????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?     USER INTERFACE LAYER       ?
?????????????????????????????????????????????????????????????????????????????
?     ?
????????????????????????????????????????????????????????????????????    ?
?  ?          ClientMessages.razor (Main Component)               ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?     ?    ?
?  ?  ????????????????????????    ??????????????????????????????   ?    ?
?  ?  ?   LEFT PANEL         ?    ?   RIGHT PANEL?   ?    ?
?  ?  ?   (Inbox List)       ?    ?   (Detail View)          ?   ?    ?
?  ?  ????????????????????????    ??????????????????????????????   ?    ?
?  ?  ? • Filter Tabs        ?    ? • Message Detail     ?   ?    ?
?  ?  ?   - All       ?    ? • Full Content     ?   ?    ?
?  ?  ?   - Unread (3)       ?    ? • Action Buttons           ?   ?    ?
?  ?  ?   - Stays    ?    ? • Category Badge     ?   ?    ?
?  ?  ?   - Offers ?    ? • CTA Buttons    ?   ?    ?
?  ?  ????????????????????????    ? • Offer Details?   ?    ?
?  ?  ? • Time Filter        ?    ??????????????????????????????   ?    ?
?  ?  ?   Last 90 days       ?    ?   OR                 ?   ?    ?
?  ?  ????????????????????????    ??????????????????????????????   ? ?
?  ?  ? • Message Cards      ?    ? • Email Hotel Form      ?   ?    ?
?  ?  ?   ?? Subject         ?    ?   - To: Hotel Team         ?   ?    ?
?  ?  ?   Preview text...    ?    ?   - Regarding dropdown     ?   ?    ?
?  ?  ?   2 days ago  ?    ?    ?   - Subject field   ?   ?    ?
?  ?  ?    ?    ?   - Message textarea       ?   ?    ?
?  ?  ?   ?? Subject   ?    ?   - Send button?   ?    ?
?  ?  ?   Preview text...    ?    ?      ?   ?    ?
?  ?  ?   Yesterday          ?    ?   ?   ?    ?
?  ?  ????????????????????????    ?????????????????????????????? ?    ?
?  ?          ?  ?
?  ?????????????????????????????????????????????????????????????????????    ?
?          ?
?  Styling: client-messages.css        ?
?  • Modern purple/white theme      ?
?  • Responsive design (desktop/tablet/mobile)       ?
?  • Smooth animations and transitions        ?
?   ?
?????????????????????????????????????????????????????????????????????????????

         ? ? ?

?????????????????????????????????????????????????????????????????????????????
?       SERVICE LAYER (Business Logic)         ?
?????????????????????????????????????????????????????????????????????????????
?       ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?         MessageService.cs      ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ? ?    ?
?  ?  ?? GetClientMessagesAsync(clientId, filter)   ?  ?
?  ? ?? Returns: List<Message> filtered by criteria      ?    ?
?  ?            ?    ?
?  ?  ?? GetUnreadCountAsync(clientId)    ?    ?
?  ?     ?? Returns: int count of unread messages      ?    ?
?  ?      ?    ?
?  ?  ? MarkAsReadAsync(messageId)         ?    ?
?  ?   ?? Updates: is_read = 1     ?    ?
?  ?          ?    ?
?  ?  ?? MarkAllAsReadAsync(clientId)     ?    ?
?  ?     ?? Updates: all messages for client            ?    ?
?  ?         ?    ?
?  ?  ?? SendEmailToHotelAsync(emailRequest)        ?    ?
?  ?     ?? Creates: outgoing message record ?    ?
?  ?        ?    ?
?  ?  ? CreateMessageAsync(message)        ?    ?
?  ?     ?? Inserts: new message into database             ??
?  ?          ?    ?
?  ?  ? DeleteMessageAsync(messageId)      ?    ?
?  ?     ?? Deletes: message from database   ?    ?
?  ?       ?    ?
?  ?  ?? GetMessageByIdAsync(messageId)           ?    ?
?  ? ?? Returns: Message details            ?    ?
?  ?           ?    ?
?  ?????????????????????????????????????????????????????????????????????    ?
?        ?
?  Registered in: MauiProgram.cs             ?
?  builder.Services.AddSingleton<MessageService>();        ?
?              ?
?????????????????????????????????????????????????????????????????????????????

  ? ? ?

?????????????????????????????????????????????????????????????????????????????
?            DATA MODEL LAYER             ?
?????????????????????????????????????????????????????????????????????????????
?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?      Message.cs      ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?  • message_id (int)        ?    ?
?  ?  • client_id (int)       ?    ?
?  ?  • message_subject (string)         ?    ?
?  ?  • message_body (string)  ?    ?
?  ?  • message_type (string)      // offer, service, billing, etc.  ?    ?
?  ?  • message_category (string)  // Member Services, Billing, etc. ??
?  ?  • is_read (bool)      ?    ?
?  ?  • sent_date (DateTime)              ?    ?
?  ?  • booking_id (int?)    // Optional link to booking       ?    ?
?  ?  • action_label (string?)  // CTA button text          ?  ?
?  ?  • action_url (string?)       // CTA button link     ?    ?
?  ?  • regarding_text (string?)   // Context information           ?    ?
?  ?  • client_name (string?)      // Computed from join   ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?               ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?         MessageFilter.cs       ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?  • FilterType (string)  // "All", "Unread", "Stays", "Offers"   ?    ?
?  ?  • TimeRange (string)   // "Last 90 days", "Last 30 days"       ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?                ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?      EmailRequest.cs ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?  • client_id (int)  ?    ?
?  ?  • regarding (string)            ?    ?
?  ?  • subject (string)   ?    ?
?  ?  • message_body (string)   ?    ?
?  ?  • email_to (string)         ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?     ?
?????????????????????????????????????????????????????????????????????????????

              ? ? ?

?????????????????????????????????????????????????????????????????????????????
?    DATABASE LAYER (SQL Server)    ?
?????????????????????????????????????????????????????????????????????????????
?   ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?     Messages Table         ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?  PK  message_id         INT IDENTITY(1,1)      ?    ?
?  ?  FK  client_id          INT NOT NULL       ?    ?
?  ?      message_subject    VARCHAR(500)    ?    ?
?  ?      message_body       TEXT          ?    ?
?  ?      message_type       VARCHAR(50)      ?    ?
?  ?      message_category   VARCHAR(200)              ?    ?
?  ?      is_read      BIT DEFAULT 0     ?    ?
?  ?      sent_date          DATETIME DEFAULT GETDATE()?    ?
?  ?  FK  booking_id         INT NULL       ?  ?
?  ?      action_label       VARCHAR(200) NULL           ?    ?
?  ?      action_url         VARCHAR(500) NULL        ?    ?
?  ? regarding_text     VARCHAR(500) NULL           ?    ?
?  ?    ?    ?
?  ?  Foreign Keys:               ?    ?
?  ?  • client_id ? Clients(client_id) ON DELETE CASCADE              ? ?
?  ?  • booking_id ? Bookings(booking_id) ON DELETE SET NULL       ?    ?
?  ?         ?    ?
?  ?  Indexes:  ?    ?
?  ?  • IX_Messages_ClientId      ?    ?
?  ?  • IX_Messages_IsRead     ?    ?
?  ?  • IX_Messages_SentDate       ?    ?
?  ???????????????????????????????????????????????????????????????????    ?
?  ?
?  Setup Script: MessagesSetup.sql      ?
?  • Creates tables if not exists        ?
?  • Creates indexes    ?
?  • Inserts sample data ?
?     ?
?????????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?            INTEGRATION POINTS   ?
?????????????????????????????????????????????????????????????????????????????
?      ?
?  ????????????????????    ????????????????????    ???????????????????   ?
?  ? Booking System   ?????? Messages System  ?????? Loyalty System  ?   ?
?  ????????????????????    ????????????????????    ???????????????????   ?
??       ?        ?       ?
?         ?     ?        ?              ?
?         ?       ?        ?       ?
?  "Booking Confirmed"      "Welcome!"           "Points Earned"     ?
?  Category: Hotel          Category: Services   Category: Rewards        ?
?  Type: service         Type: general      Type: service   ?
?  Link: booking_id    Link: none       Link: none       ?
? ?
?  ????????????????????       ???????????????????     ?
?  ? Payment System   ?????????????????????????  ? Messages System ?     ?
?  ???????????????????????????????????????     ?
?         ?         ?  ?
?         ?            ?      ?
?  "Receipt Available"   Stored in database       ?
?  Category: Billing Displayed in inbox       ?
?  Type: billing       ?
?  Link: booking_id ?
?            ?
?????????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?                 NAVIGATION FLOW    ?
?????????????????????????????????????????????????????????????????????????????
?     ?
?  Client Profile ???????        ?
?  (Dashboard)    ?   ?
?          ?        ?
?  New Booking ??????????????? Messages Link ????? /client/messages/{id}  ?
?           ?    ?
?  Room Selection ???????  ?
?           ?     ?
?  Client Loyalty ???????        ?
?           ?
?  All pages have consistent top navigation with "Messages" tab ?
??
?????????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?    USER WORKFLOWS      ?
?????????????????????????????????????????????????????????????????????????????
?         ?
?  Workflow 1: View Messages       ?
?  ??????????????????????????????????????????????????????????????????   ?
?  ? 1. Click "Messages" in navigation   ?     ?
?  ? 2. View inbox list with unread count  ?     ?
?  ? 3. Click message to view details            ?     ?
?  ? 4. Message automatically marked as read?     ?
?  ? 5. Click action button if available (e.g., "Book a stay")      ?     ?
?  ??????????????????????????????????????????????????????????????????     ?
?         ?
?  Workflow 2: Filter Messages    ?
?  ??????????????????????????????????????????????????????????????????     ?
?  ? 1. Click filter tab (Unread, Stays, Offers)          ?     ?
?  ? 2. Inbox updates to show filtered results        ?     ?
?  ? 3. Select message to view details                 ?   ?
?  ??????????????????????????????????????????????????????????????????     ?
?       ?
?  Workflow 3: Email Hotel Team    ?
?  ??????????????????????????????????????????????????????????????????     ?
?  ? 1. Click "Email the hotel team" button         ?     ?
?  ? 2. Select "Regarding" option from dropdown  ?     ?
?  ? 3. Enter subject and message             ?     ?
?  ? 4. Click "Send email to hotel"  ?     ?
?  ? 5. Email saved as outgoing message     ?     ?
?  ? 6. Return to inbox        ?     ?
?  ??????????????????????????????????????????????????????????????????     ?
?           ?
?????????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?       MESSAGE CATEGORIES            ?
?????????????????????????????????????????????????????????????????????????????
?    ?
?  ?? Member Services           ?
?  ?? Welcome messages  ?
?  ?? Account updates     ?
?  ?? Profile changes              ?
?           ?
?  ?? Billing & Receipts    ?
?  ?? Payment confirmations    ?
?  ?? Invoices available       ?
?  ?? Refund notifications    ?
?    ?
?  ?? Harbourkey Waterfront            ?
?  ?? Booking confirmations  ?
?  ?? Check-in reminders ?
?  ?? Thank you messages           ?
?  ?? Service requests           ?
?             ?
?  ? Membership Rewards?
?  ?? Exclusive offers           ?
?  ?? Points earned notifications            ?
?  ?? Tier upgrades            ?
?  ?? Special promotions   ?
?        ?
?  ?? Email Sent      ?
?  ?? Client emails to hotel         ?
?  ?? Sent message history ?
?     ?
?????????????????????????????????????????????????????????????????????????????

?????????????????????????????????????????????????????????????????????????????
?    RESPONSIVE DESIGN        ?
?????????????????????????????????????????????????????????????????????????????
?     ?
?  Desktop (1024px+)          Tablet (768-1023px)      Mobile (<768px)     ?
?  ????????????????????       ?????????????????? ????????????????    ?
?  ? Inbox  ? Detail  ?       ?    Inbox       ?     ?    Inbox     ?    ?
?  ?        ?         ? ?                ?     ?            ?    ?
?  ? [Msg1] ? Content ?       ? [Msg1]         ?     ? [Msg1]       ?    ?
?  ? [Msg2] ? Actions ?    ? [Msg2]       ?     ? [Msg2]  ?    ?
?  ? [Msg3] ? CTA     ?       ? [Msg3]         ?     ? [Msg3]       ?    ?
?  ????????????????????       ??????????????????     ????????????????    ?
?   Two columns               Single + Overlay         Mobile Stack       ?
?       ?
?????????????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????????????
               SYSTEM STATUS: ? COMPLETE
???????????????????????????????????????????????????????????????????????????
```
